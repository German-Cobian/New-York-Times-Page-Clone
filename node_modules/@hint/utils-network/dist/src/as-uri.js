"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getAsUris = exports.getAsUri = void 0;
const url = require("url");
const url_1 = require("url");
const fileUrl = require("file-url");
const compact = require("lodash/compact");
const utils_debug_1 = require("@hint/utils-debug");
const utils_fs_1 = require("@hint/utils-fs");
const logger = require("@hint/utils/dist/src/logging");
const debug = utils_debug_1.debug(__filename);
exports.getAsUri = (source) => {
    let target;
    try {
        target = new url_1.URL(source);
    }
    catch (err) {
        {
            target = null;
        }
    }
    const protocol = target ? target.protocol : null;
    if (protocol === 'http:' || protocol === 'https:' || protocol === 'file:') {
        debug(`Adding valid target: ${target && url.format(target)}`);
        return target;
    }
    if (utils_fs_1.isFile(source) || utils_fs_1.isDirectory(source)) {
        target = new url_1.URL(fileUrl(source));
        debug(`Adding valid target: ${url.format(target)}`);
        return target;
    }
    target = new url_1.URL(`http://${source}`);
    if (!utils_fs_1.pathExists(source) && (target.hostname === 'localhost' || target.hostname.includes('.'))) {
        debug(`Adding modified target: ${url.format(target)}`);
        return target;
    }
    logger.error(`Ignoring '${source}' as it's not an existing file nor a valid URL`);
    return null;
};
exports.getAsUris = (source) => {
    const targets = source.reduce((uris, entry) => {
        const uri = exports.getAsUri(entry);
        if (uri) {
            uris.push(uri);
        }
        return uris;
    }, []);
    return compact(targets);
};
